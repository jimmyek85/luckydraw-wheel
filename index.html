<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1602 Lucky Draw</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }
        
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto;
        }
        
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
            transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 11px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            text-align: center;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .wheel-text {
            transform: rotate(-45deg);
            width: 80%;
            line-height: 1.2;
        }
        
        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #ff6b6b;
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .neon-ring {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 440px;
            height: 440px;
            border-radius: 50%;
            border: 4px solid transparent;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #dda0dd, #ff6b6b);
            background-size: 400% 400%;
            animation: neonGlow 2s ease-in-out infinite alternate, rotateNeon 8s linear infinite;
            z-index: -1;
        }
        
        @keyframes neonGlow {
            0% { box-shadow: 0 0 20px rgba(255, 107, 107, 0.8); }
            100% { box-shadow: 0 0 40px rgba(78, 205, 196, 0.8), 0 0 60px rgba(69, 183, 209, 0.6); }
        }
        
        @keyframes rotateNeon {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .spin-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: none;
            color: white;
            font-size: 18px;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        
        .spin-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .share-button {
            transition: all 0.3s ease;
        }
        
        .share-button:hover {
            transform: translateY(-2px);
        }
        
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .language-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .language-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            z-index: 5;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <!-- Language Toggle -->
    <div class="language-toggle">
        <button class="language-btn active" onclick="setLanguage('en')">English</button>
        <button class="language-btn" onclick="setLanguage('zh')">‰∏≠Êñá</button>
    </div>

    <div id="app" class="min-h-screen flex items-center justify-center p-4">
        <!-- Landing Page -->
        <div id="landing-page" class="text-center text-white max-w-md">
            <h1 class="text-5xl font-bold mb-6 text-shadow-lg" data-en="1602 Lucky Draw" data-zh="1602 Âπ∏ËøêÊäΩÂ•ñ">1602 Lucky Draw</h1>
            <p class="text-xl mb-8 opacity-90" data-en="Welcome to Kuching Festival! Visit 1602 booth for amazing prizes!" data-zh="Ê¨¢ËøéÊù•Âà∞Âè§ÊôãËäÇÔºÅÂâçÊù•1602Ê°£Âè£ÂèÇ‰∏éÊäΩÂ•ñÂ§ßÂõûÈ¶àÔºÅ">Welcome to Kuching Festival! Visit 1602 booth for amazing prizes!</p>
            <button id="enter-btn" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-4 px-8 rounded-lg text-xl transition-all duration-300 transform hover:scale-105" data-en="Enter Lucky Draw" data-zh="ËøõÂÖ•ÊäΩÂ•ñ">
                Enter Lucky Draw
            </button>
        </div>

        <!-- Registration Page -->
        <div id="register-page" class="hidden bg-white bg-opacity-10 backdrop-blur-lg rounded-lg p-8 max-w-md w-full border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center mb-6 text-white" data-en="Join 1602 Lucky Draw" data-zh="Âä†ÂÖ•1602ÊäΩÂ•ñ">Join 1602 Lucky Draw</h2>
            <form id="register-form">
                <div class="mb-4">
                    <input type="text" id="name" placeholder="Full Name (Required)" required 
                           class="w-full p-3 border border-white border-opacity-30 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           data-placeholder-en="Full Name (Required)" data-placeholder-zh="ÂßìÂêçÔºàÂøÖÂ°´Ôºâ">
                </div>
                <div class="mb-4">
                    <input type="tel" id="phone" placeholder="Phone Number (Required)" required 
                           class="w-full p-3 border border-white border-opacity-30 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           data-placeholder-en="Phone Number (Required)" data-placeholder-zh="ÁîµËØùÂè∑Á†ÅÔºàÂøÖÂ°´Ôºâ">
                </div>
                <div class="mb-6">
                    <input type="email" id="email" placeholder="Email (Optional)" 
                           class="w-full p-3 border border-white border-opacity-30 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           data-placeholder-en="Email (Optional)" data-placeholder-zh="ÈÇÆÁÆ±ÔºàÈÄâÂ°´Ôºâ">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 rounded-lg transition-all duration-300 transform hover:scale-105" data-en="Register & Get Lucky Draw Chance!" data-zh="Ê≥®ÂÜåÂπ∂Ëé∑ÂèñÊäΩÂ•ñÊú∫‰ºöÔºÅ">
                    Register & Get Lucky Draw Chance!
                </button>
            </form>
        </div>

        <!-- Wheel Page -->
        <div id="wheel-page" class="hidden text-center text-white">
            <h2 class="text-4xl font-bold mb-4" data-en="1602 Lucky Wheel" data-zh="1602 Âπ∏ËøêËΩÆÁõò">1602 Lucky Wheel</h2>
            <p class="mb-2" data-en="Welcome," data-zh="Ê¨¢ËøéÔºå">Welcome, <span id="user-name">User</span></p>
            <p class="mb-6 text-lg"><span id="chances-left">1</span> <span data-en="chances left" data-zh="Ê¨°Êú∫‰ºö">chances left</span></p>
            
            <div class="wheel-container mb-8">
                <div class="neon-ring"></div>
                <div class="pointer"></div>
                <div id="wheel" class="wheel">
                    <!-- Wheel segments will be generated by JavaScript -->
                </div>
                <div class="center-circle">1602</div>
            </div>
            
            <div>
                <button id="spin-btn" class="spin-button" data-en="SPIN" data-zh="ÂºÄÂßãÊäΩÂ•ñ">
                    <i class="fas fa-play mr-2"></i>SPIN (1 <span data-en="chances left" data-zh="Ê¨°Êú∫‰ºö">chances left</span>)
                </button>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="result-modal" class="hidden fixed inset-0 modal flex items-center justify-center z-50 p-4">
            <div class="modal-content p-8 max-w-md w-full text-center text-white">
                <div id="modal-icon" class="text-6xl mb-4">üéâ</div>
                <h3 id="modal-title" class="text-3xl font-bold mb-4">Congratulations!</h3>
                <div id="modal-content" class="mb-6 text-lg">
                    <p>You won a prize!</p>
                </div>
                <div id="share-section" class="mb-6">
                    <p class="mb-4 text-sm opacity-90" data-en="Share with friends to get an extra RM2 cash voucher!" data-zh="ÂàÜ‰∫´ÁªôÊúãÂèãËé∑ÂæóÈ¢ùÂ§ñRM2Áé∞ÈáëÂà∏ÔºÅ">Share with friends to get an extra RM2 cash voucher!</p>
                    <div class="flex gap-3 justify-center">
                        <button id="share-fb" class="share-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                            <i class="fab fa-facebook-f"></i>
                            <span data-en="Share FB" data-zh="ÂàÜ‰∫´FB">Share FB</span>
                        </button>
                        <button id="share-whatsapp" class="share-button bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                            <i class="fab fa-whatsapp"></i>
                            <span data-en="WhatsApp" data-zh="WhatsApp">WhatsApp</span>
                        </button>
                        <button id="copy-link" class="share-button bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                            <i class="fas fa-copy"></i>
                            <span data-en="Copy" data-zh="Â§çÂà∂">Copy</span>
                        </button>
                    </div>
                </div>
                <button id="modal-close" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded-lg transition-all duration-300" data-en="Close" data-zh="ÂÖ≥Èó≠">
                    Close
                </button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="hidden fixed bottom-4 right-4 bg-black bg-opacity-80 text-white p-4 rounded-lg">
            <h4 class="font-bold mb-2">Staff Panel</h4>
            <div class="flex gap-2 mb-2">
                <input type="tel" id="admin-phone" placeholder="Phone Number" class="px-2 py-1 text-black rounded">
                <button id="find-user" class="bg-blue-500 px-3 py-1 rounded text-sm">Find</button>
            </div>
            <div class="flex gap-2">
                <button id="add-chance" class="bg-green-500 px-3 py-1 rounded text-sm">+1 Chance</button>
                <button id="toggle-admin" class="bg-red-500 px-3 py-1 rounded text-sm">Hide</button>
            </div>
            <div id="user-info" class="mt-2 text-xs"></div>
        </div>
    </div>

    <!-- Admin Toggle Button -->
    <button id="admin-toggle" class="fixed bottom-4 left-4 bg-gray-800 text-white p-2 rounded-full opacity-50 hover:opacity-100" onclick="toggleAdmin()">
        <i class="fas fa-cog"></i>
    </button>

    <script>
        // Prize data with exact probabilities as requested
        const prizes = [
            { text: 'Beer Card', textZh: 'ÈÖíÂç°', color: '#FF6B6B', weight: 0 }, // 0/100
            { text: 'RM5 Cash Voucher', textZh: 'Áé∞ÈáëÂà∏RM5', color: '#4ECDC4', weight: 16 }, // 16/100
            { text: 'RM10 Online Voucher', textZh: 'Á∫ø‰∏äÁé∞ÈáëÂà∏RM10', color: '#45B7D1', weight: 9 }, // 9/100
            { text: 'RM20 Online Voucher', textZh: 'Á∫ø‰∏äÁé∞ÈáëÂà∏RM20', color: '#96CEB4', weight: 6 }, // 6/100
            { text: '330ml Lager Smooth', textZh: '330mlÊñ∞ÂìÅLager', color: '#FFEAA7', weight: 9 }, // 9/100
            { text: '660ml Bottle', textZh: '660mlÁì∂Ë£Ö', color: '#DDA0DD', weight: 6 }, // 6/100
            { text: '1602 Pen', textZh: '1602Á∫™ÂøµÁ¨î', color: '#FF8E8E', weight: 12 }, // 12/100
            { text: '1602 Cooler Bag', textZh: '1602‰øùÂÜ∑Ë¢ã', color: '#8ED1FC', weight: 12 }, // 12/100
            { text: '1602 Mug', textZh: '1602Á∫™ÂøµÈô∂Áì∑ÊùØ', color: '#C7ECEE', weight: 0 }, // 0/100
            { text: 'Thank You', textZh: 'Ë∞¢Ë∞¢ÂèÇ‰∏é', color: '#FFB6C1', weight: 14 }, // 14/100
            { text: 'Spin Again', textZh: 'ÂÜçÊù•‰∏ÄÊ¨°', color: '#98FB98', weight: 16 } // 16/100
        ];

        // Global variables
        let currentUser = null;
        let currentLanguage = 'en';
        let isSpinning = false;
        let adminUser = null;

        // Local storage functions
        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function getFromLocalStorage(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }

        // User data management
        function saveUserData(userId, userData) {
            saveToLocalStorage(`user_${userId}`, userData);
            
            // Also save to users list
            const users = getFromLocalStorage('all_users') || {};
            users[userId] = userData;
            saveToLocalStorage('all_users', users);
        }

        function getUserData(userId) {
            return getFromLocalStorage(`user_${userId}`);
        }

        function updateUserData(userId, updates) {
            const existing = getUserData(userId) || {};
            const updated = { ...existing, ...updates };
            saveUserData(userId, updated);
            return updated;
        }

        // Language functions
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.onclick && btn.onclick.toString().includes(lang)) {
                    btn.classList.add('active');
                }
            });
            updateLanguage();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-en]').forEach(element => {
                const text = element.getAttribute(`data-${currentLanguage}`);
                if (text) {
                    element.textContent = text;
                }
            });

            document.querySelectorAll('[data-placeholder-en]').forEach(element => {
                const placeholder = element.getAttribute(`data-placeholder-${currentLanguage}`);
                if (placeholder) {
                    element.placeholder = placeholder;
                }
            });
        }

        // Draw wheel
        function drawWheel() {
            const wheel = document.getElementById('wheel');
            wheel.innerHTML = '';
            const segmentAngle = 360 / prizes.length;
            
            prizes.forEach((prize, index) => {
                const segment = document.createElement('div');
                segment.className = 'wheel-segment';
                segment.style.backgroundColor = prize.color;
                segment.style.transform = `rotate(${index * segmentAngle}deg)`;
                segment.style.clipPath = `polygon(0 0, 100% 0, 50% 100%)`;
                
                const text = document.createElement('div');
                text.className = 'wheel-text';
                text.textContent = currentLanguage === 'en' ? prize.text : prize.textZh;
                segment.appendChild(text);
                
                wheel.appendChild(segment);
            });
        }

        // Select prize by weight
        function selectPrize() {
            const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
            if (totalWeight === 0) return prizes[0]; // Fallback
            
            const random = Math.random() * totalWeight;
            let currentWeight = 0;
            
            for (const prize of prizes) {
                currentWeight += prize.weight;
                if (random <= currentWeight) {
                    return prize;
                }
            }
            return prizes[0];
        }

        // Show result modal
        function showResult(prize) {
            const modal = document.getElementById('result-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            const icon = document.getElementById('modal-icon');
            
            if (!modal || !title || !content || !icon) {
                console.error('Modal elements not found');
                alert(currentLanguage === 'en' ? 'Display error, please refresh the page' : 'ÊòæÁ§∫ÈîôËØØÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            
            try {
                if (prize.text === 'Thank You') {
                    icon.textContent = 'üòî';
                    title.textContent = currentLanguage === 'en' ? 'Thank You for Playing!' : 'ÊÑüË∞¢ÂèÇ‰∏éÔºÅ';
                    content.innerHTML = `<p>${currentLanguage === 'en' ? 'Better luck next time!' : 'Á•ùÊÇ®‰∏ãÊ¨°Â•ΩËøêÔºÅ'}</p>`;
                } else if (prize.text === 'Spin Again') {
                    icon.textContent = 'üéØ';
                    title.textContent = currentLanguage === 'en' ? 'Spin Again!' : 'ÂÜçÊù•‰∏ÄÊ¨°ÔºÅ';
                    content.innerHTML = `<p>${currentLanguage === 'en' ? 'You got an extra spin chance!' : 'ÊÇ®Ëé∑Âæó‰∫ÜÈ¢ùÂ§ñÁöÑÊäΩÂ•ñÊú∫‰ºöÔºÅ'}</p>`;
                } else {
                    icon.textContent = 'üéâ';
                    title.textContent = currentLanguage === 'en' ? 'Congratulations!' : 'ÊÅ≠ÂñúÔºÅ';
                    const prizeText = currentLanguage === 'en' ? prize.text : prize.textZh;
                    content.innerHTML = `<p>${currentLanguage === 'en' ? 'You won:' : 'ÊÇ®Ëé∑Âæó‰∫ÜÔºö'} <strong>${prizeText}</strong>!</p>`;
                }
                
                modal.classList.remove('hidden');
            } catch (error) {
                console.error('Error showing result:', error);
                alert(currentLanguage === 'en' ? 'Result display error' : 'ÁªìÊûúÊòæÁ§∫ÈîôËØØ');
            }
        }

        // Spin function
        async function spin() {
            if (!currentUser) {
                alert(currentLanguage === 'en' ? 'Please register first' : 'ËØ∑ÂÖàÊ≥®ÂÜå');
                return;
            }
            
            if (isSpinning) return;
            
            const spinBtn = document.getElementById('spin-btn');
            const wheel = document.getElementById('wheel');
            const chancesLeftEl = document.getElementById('chances-left');
            
            if (!spinBtn || !wheel || !chancesLeftEl) {
                console.error('Required elements not found for spinning');
                alert(currentLanguage === 'en' ? 'Spin error, please refresh the page' : 'ÊäΩÂ•ñÈîôËØØÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            
            const chancesLeft = parseInt(chancesLeftEl.textContent);
            
            if (chancesLeft <= 0) {
                alert(currentLanguage === 'en' ? 'No chances left!' : 'Ê≤°ÊúâÊäΩÂ•ñÊú∫‰ºö‰∫ÜÔºÅ');
                return;
            }
            
            isSpinning = true;
            spinBtn.disabled = true;
            spinBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>${currentLanguage === 'en' ? 'Spinning...' : 'ÊäΩÂ•ñ‰∏≠...'}`;
            
            // Spin animation
            const randomRotation = Math.random() * 360 + 1440; // At least 4 full rotations
            wheel.style.transform = `rotate(${randomRotation}deg)`;
            
            setTimeout(async () => {
                const prize = selectPrize();
                
                try {
                    if (currentUser) {
                        const now = new Date();
                        const newPrize = {
                            prize: currentLanguage === 'en' ? prize.text : prize.textZh,
                            timestamp: now.toISOString(),
                            language: currentLanguage
                        };
                        
                        const updates = {
                            lastSpin: now.toISOString(),
                            prizes: [...(currentUser.prizes || []), newPrize]
                        };
                        
                        if (prize.text !== 'Spin Again') {
                            updates.chances = Math.max(0, chancesLeft - 1);
                            if (chancesLeftEl) {
                                chancesLeftEl.textContent = updates.chances;
                            }
                            currentUser.chances = updates.chances;
                        } else {
                            // Spin Again gives an extra chance
                            updates.chances = chancesLeft;
                        }
                        
                        currentUser.prizes = updates.prizes;
                        currentUser.lastSpin = updates.lastSpin;
                        
                        updateUserData(currentUser.id, updates);
                    }
                    
                    showResult(prize);
                } catch (error) {
                    console.error('Error updating user data:', error);
                    showResult(prize);
                }
                
                isSpinning = false;
                spinBtn.disabled = false;
                const chancesText = currentLanguage === 'en' ? 'chances left' : 'Ê¨°Êú∫‰ºö';
                spinBtn.innerHTML = `<i class="fas fa-play mr-2"></i>${currentLanguage === 'en' ? 'SPIN' : 'ÂºÄÂßãÊäΩÂ•ñ'} (${currentUser?.chances || 0} ${chancesText})`;
            }, 4000);
        }

        // Registration handler
        async function handleRegistration(e) {
            e.preventDefault();
            
            const nameEl = document.getElementById('name');
            const phoneEl = document.getElementById('phone');
            const emailEl = document.getElementById('email');
            
            if (!nameEl || !phoneEl) {
                console.error('Required form elements not found');
                alert('Form error, please refresh the page');
                return;
            }
            
            const name = nameEl.value.trim();
            const phone = phoneEl.value.trim();
            const email = emailEl ? emailEl.value.trim() : '';
            
            if (!name || !phone) {
                alert(currentLanguage === 'en' ? 'Please fill in required fields' : 'ËØ∑Â°´ÂÜôÂøÖÂ°´È°π');
                return;
            }
            
            try {
                const userData = getUserData(phone);
                
                if (userData) {
                    currentUser = { id: phone, ...userData };
                    alert(currentLanguage === 'en' ? 'User exists, loading your data...' : 'Áî®Êà∑Â∑≤Â≠òÂú®ÔºåÊ≠£Âú®Âä†ËΩΩÊÇ®ÁöÑÊï∞ÊçÆ...');
                } else {
                    const newUserData = {
                        name: name,
                        phone: phone,
                        email: email,
                        chances: 1,
                        prizes: [],
                        createdAt: new Date().toISOString(),
                        language: currentLanguage
                    };
                    
                    saveUserData(phone, newUserData);
                    currentUser = { id: phone, ...newUserData };
                    alert(currentLanguage === 'en' ? 'Registration successful!' : 'Ê≥®ÂÜåÊàêÂäüÔºÅ');
                }
                
                // Update UI with safety checks
                const userNameEl = document.getElementById('user-name');
                const chancesLeftEl = document.getElementById('chances-left');
                const registerPageEl = document.getElementById('register-page');
                const wheelPageEl = document.getElementById('wheel-page');
                
                if (userNameEl) userNameEl.textContent = currentUser.name;
                if (chancesLeftEl) chancesLeftEl.textContent = currentUser.chances || 1;
                
                // Switch to wheel page
                if (registerPageEl) registerPageEl.classList.add('hidden');
                if (wheelPageEl) wheelPageEl.classList.remove('hidden');
                
                // Redraw wheel with current language
                drawWheel();
                
            } catch (error) {
                console.error('Registration error:', error);
                alert(currentLanguage === 'en' ? 'Registration failed, please try again' : 'Ê≥®ÂÜåÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        // Share functions
        function shareToFacebook() {
            const shareText = currentLanguage === 'en' 
                ? "Welcome to Kuching Festival! Come to 1602 booth and join our lucky draw for amazing prizes!"
                : "Ê¨¢ËøéÊù•Âà∞Âè§ÊôãËäÇÔºåÂâçÊù•1602Ê°£Âè£‰∏ÄÂêåÂèÇ‰∏éÊàë‰ª¨ÊäΩÂ•ñÂ§ßÂõûÈ¶à„ÄÇ";
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(shareText);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
        }

        function shareToWhatsApp() {
            const shareText = currentLanguage === 'en' 
                ? "Welcome to Kuching Festival! Come to 1602 booth and join our lucky draw for amazing prizes! " + window.location.href
                : "Ê¨¢ËøéÊù•Âà∞Âè§ÊôãËäÇÔºåÂâçÊù•1602Ê°£Âè£‰∏ÄÂêåÂèÇ‰∏éÊàë‰ª¨ÊäΩÂ•ñÂ§ßÂõûÈ¶à„ÄÇ" + window.location.href;
            const text = encodeURIComponent(shareText);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        function copyLink() {
            const shareText = currentLanguage === 'en' 
                ? "Welcome to Kuching Festival! Come to 1602 booth and join our lucky draw for amazing prizes! " + window.location.href
                : "Ê¨¢ËøéÊù•Âà∞Âè§ÊôãËäÇÔºåÂâçÊù•1602Ê°£Âè£‰∏ÄÂêåÂèÇ‰∏éÊàë‰ª¨ÊäΩÂ•ñÂ§ßÂõûÈ¶à„ÄÇ" + window.location.href;
            navigator.clipboard.writeText(shareText).then(() => {
                alert(currentLanguage === 'en' ? 'Link copied to clipboard!' : 'ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
            });
        }

        // Admin functions
        function toggleAdmin() {
            const panel = document.getElementById('admin-panel');
            if (panel) {
                panel.classList.toggle('hidden');
            } else {
                console.error('Admin panel element not found');
            }
        }

        function findUser() {
            const phoneEl = document.getElementById('admin-phone');
            const userInfoEl = document.getElementById('user-info');
            
            if (!phoneEl || !userInfoEl) {
                console.error('Admin form elements not found');
                alert('Admin panel error, please refresh the page');
                return;
            }
            
            const phone = phoneEl.value.trim();
            if (!phone) {
                alert('Please enter a phone number');
                return;
            }
            
            try {
                const userData = getUserData(phone);
                
                if (userData) {
                    adminUser = { id: phone, ...userData };
                    userInfoEl.innerHTML = `
                        <div>Name: ${userData.name}</div>
                        <div>Chances: ${userData.chances || 0}</div>
                        <div>Prizes: ${userData.prizes?.length || 0}</div>
                    `;
                } else {
                    userInfoEl.innerHTML = '<div>User not found</div>';
                    adminUser = null;
                }
            } catch (error) {
                console.error('Error finding user:', error);
                userInfoEl.innerHTML = '<div>Error finding user</div>';
                adminUser = null;
            }
        }

        function addChance() {
            if (!adminUser) {
                alert('Please find a user first');
                return;
            }
            
            const userInfoEl = document.getElementById('user-info');
            const chancesLeftEl = document.getElementById('chances-left');
            
            if (!userInfoEl) {
                console.error('User info element not found');
                alert('Admin panel error, please refresh the page');
                return;
            }
            
            try {
                const updated = updateUserData(adminUser.id, {
                    chances: (adminUser.chances || 0) + 1
                });
                
                adminUser = { id: adminUser.id, ...updated };
                userInfoEl.innerHTML = `
                    <div>Name: ${updated.name}</div>
                    <div>Chances: ${updated.chances || 0}</div>
                    <div>Prizes: ${updated.prizes?.length || 0}</div>
                `;
                
                // Update current user if it's the same person
                if (currentUser && currentUser.id === adminUser.id) {
                    currentUser = adminUser;
                    if (chancesLeftEl) {
                        chancesLeftEl.textContent = currentUser.chances;
                    }
                }
                
                alert('Chance added successfully!');
            } catch (error) {
                console.error('Error adding chance:', error);
                alert('Failed to add chance, please try again');
            }
        }

        // Initialize app
        function initApp() {
            try {
                console.log('Initializing 1602 Lucky Draw...');
                
                // Draw wheel
                drawWheel();
                
                // Event listeners with safety checks
                const enterBtn = document.getElementById('enter-btn');
                const registerForm = document.getElementById('register-form');
                const spinBtn = document.getElementById('spin-btn');
                const modalClose = document.getElementById('modal-close');
                const shareFb = document.getElementById('share-fb');
                const shareWhatsapp = document.getElementById('share-whatsapp');
                const copyLinkBtn = document.getElementById('copy-link');
                const findUserBtn = document.getElementById('find-user');
                const addChanceBtn = document.getElementById('add-chance');
                const toggleAdminBtn = document.getElementById('toggle-admin');
                
                if (enterBtn) {
                    enterBtn.addEventListener('click', () => {
                        const landingPage = document.getElementById('landing-page');
                        const registerPage = document.getElementById('register-page');
                        if (landingPage) landingPage.classList.add('hidden');
                        if (registerPage) registerPage.classList.remove('hidden');
                    });
                }
                
                if (registerForm) {
                    registerForm.addEventListener('submit', handleRegistration);
                }
                
                if (spinBtn) {
                    spinBtn.addEventListener('click', spin);
                }
                
                if (modalClose) {
                    modalClose.addEventListener('click', () => {
                        const resultModal = document.getElementById('result-modal');
                        if (resultModal) resultModal.classList.add('hidden');
                    });
                }
                
                // Share buttons
                if (shareFb) shareFb.addEventListener('click', shareToFacebook);
                if (shareWhatsapp) shareWhatsapp.addEventListener('click', shareToWhatsApp);
                if (copyLinkBtn) copyLinkBtn.addEventListener('click', copyLink);
                
                // Admin functions
                if (findUserBtn) findUserBtn.addEventListener('click', findUser);
                if (addChanceBtn) addChanceBtn.addEventListener('click', addChance);
                if (toggleAdminBtn) {
                    toggleAdminBtn.addEventListener('click', () => {
                        const adminPanel = document.getElementById('admin-panel');
                        if (adminPanel) adminPanel.classList.add('hidden');
                    });
                }
                
                // Language update
                updateLanguage();
                
                console.log('1602 Lucky Draw initialized successfully');
                
            } catch (error) {
                console.error('Initialization error:', error);
                const appEl = document.getElementById('app');
                if (appEl) {
                    appEl.innerHTML = `
                        <div class="text-center text-white">
                            <h2 class="text-2xl font-bold mb-4">Connection Error</h2>
                            <p>Unable to connect to server, please try again later</p>
                            <p class="text-sm mt-2">Error: ${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Start app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>


